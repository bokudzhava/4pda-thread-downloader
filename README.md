# 4PDA Thread Downloader

Пользовательский скрипт для Tampermonkey, предназначенный для скачивания веток форума **4PDA** в текстовый файл (.txt).

Скрипт подходит для создания архивов для чтения и для анализа через LLM (RAG, Fine-tuning).

### Основное
*   **Автоматизация:** Скачивает выбранный диапазон страниц или всю ветку целиком.
*   **Массовое скачивание:** Возможность запустить скачивание одновременно на всех открытых вкладках с форумом.
*   **Компактный UI:** Минималистичная панель управления.
*   **Защита от бана:** Настраиваемая пауза между запросами и рандомная задержка старта для разных вкладок.

### Режим «Для ИИ»
Режим форматирования текста для максимальной экономии токенов и чистоты данных:
*   **Строгий лог:** Формат #Номер Ник: Сообщение.
*   **Удаление шума:** Вырезаются даты, подписи, причины редактирования, лишние пробелы и табуляции.
*   **Сжатие цитат:** Вместо дублирования текста цитаты создается ссылка на пост-источник (>#123).
*   **Фильтр контента:**
    *   Картинки заменяются на токен [IMG].
    *   Длинные технические ссылки заменяются на [LINK].
    *   Внешние ссылки очищаются от протоколов.
*   **Чистка диалогов:** Удаляются повторяющиеся ники при ответах (формат >#123 Текст вместо >> #123 User, Текст).

### Стандартный режим (для чтения)
*   Сохраняет структуру диалога, время и дату.
*   Преобразует HTML-цитаты в текст с «ёлочками».
*   Сохраняет полные URL ссылок.

---

## Установка

1.  Установите расширение Tampermonkey для вашего браузера.
2.  Скачайте и установите скрипт: **[Установить скрипт](https://github.com/bokudzhava/4pda-thread-downloader/raw/refs/heads/main/4pda-thread-downloader-1.2.user.js)**

## Использование

1.  Откройте нужные темы на форуме 4pda.to (или 4pda.ru). Требуется авторизация на сайте.
2.  В правом нижнем углу появится круглая кнопка ⇓.
3.  Нажмите её, чтобы открыть настройки:
    *   **С стр / По стр:** Диапазон страниц (определяется автоматически).
    *   **Пауза:** Задержка в мс (рекомендуется 1200+ мс).
    *   **Для ИИ:** Включить режим оптимизации для датасетов.
    *   **На всех вкладках:** Отправить команду старта всем открытым вкладкам 4PDA с текущими настройками.
4.  Нажмите **СКАЧАТЬ**.
5.  Следите за прогрессом на панели. По завершении файл сохранится автоматически.

---

## Сравнение форматов

### 1. Стандартный режим
Подходит для чтения, архивации и поиска информации человеком.

```text
Время: 12.11.24, 14:21
Автор: densen2002
Номер: #3
Сообщение:
>> #2 SanyaPDA,

SanyaPDA @ 12.11.24, 11:09 [ #2 ]
«Второй вопрос РРР сикрет задан пользователь для ВПН...»

на столе проверяли или только через интернет?
смахивает на DPI [ https://google.com/... ]
```

### 2. Режим «Для ИИ»
Максимальная плотность информации.

```text
#3 densen2002: >#2 на столе проверяли или только через интернет? смахивает на DPI [ google.com/... ]
#4 SanyaPDA: >#3 Проверял только через инет. Клиент утверждает что после накатывания бекапа всё восстановилось.
#5 UserOne: Вот скриншот настроек [IMG] и ссылка на прошивку [LINK]
```

---

## Важная информация

1.  **Кодировка:** Скрипт принудительно декодирует ответы сервера из windows-1251.
2.  **Лимиты сайта:**
    *   Не ставьте паузу менее 1000 мс.
    *   При использовании опции **"На всех вкладках"** увеличьте паузу до **2000-3000 мс**, так как суммарное количество запросов к серверу возрастает пропорционально числу вкладок. Частые запросы могут привести к временной блокировке IP (ошибка 403).
3.  **Cookies:** Скрипт работает от вашего имени, используя текущую сессию браузера. Данные никуда не передаются.
