Вот обновленный `README.md`, отражающий все последние изменения (компактный интерфейс, режим для ИИ, фильтрация изображений и ссылок, исправление дублей).

***

# 4PDA Thread Downloader

Пользовательский скрипт для [Tampermonkey](https://www.tampermonkey.net/), предназначенный для скачивания веток форума **4PDA** в текстовый файл (`.txt`).

Скрипт идеально подходит как для создания **архивов для чтения**, так и для анализа через **LLM**.

### Основное
*   **Автоматизация:** Скачивает выбранный диапазон страниц или всю ветку целиком.
*   **Компактный UI:** Минималистичная панель управления в стиле сайта.
*   **Защита от бана:** Настраиваемая пауза между запросами для обхода защиты (Cloudflare/Captcha).

### Режим «Для ИИ»
Режим, который форматирует текст для максимальной экономии токенов и чистоты данных:
*   **Строгий лог:** Формат `#Номер Ник: Сообщение`.
*   **Удаление шума:** Вырезаются даты, подписи, причины редактирования и лишние пробелы.
*   **Сжатие цитат:** Вместо дублирования текста цитаты создается ссылка на пост-источник (`>#123`).
*   **Фильтр контента:**
    *   Картинки заменяются на токен `[IMG]`.
    *   Длинные технические ссылки заменяются на `[LINK]`.
    *   Внешние ссылки очищаются от протоколов (`https://`).
*   **Чистка диалогов:** Удаляются повторяющиеся ники при ответах (формат `>#123 Текст` вместо `>> #123 User, Текст`).

### Стандартный режим (для чтения)
*   Сохраняет структуру диалога, время и дату.
*   Преобразует HTML-цитаты в текст с «ёлочками».
*   Сохраняет полные URL ссылок.

---

## Установка

1.  Установите расширение **[Tampermonkey](https://www.tampermonkey.net/)** для вашего браузера.
2.  Скачайте и установите скрипт: **[Установить скрипт]([4pda-thread-downloader.user.js](https://github.com/bokudzhava/4pda-thread-downloader/raw/refs/heads/main/4pda-thread-downloader-1.1.user.js))**

## Использование

1.  Откройте любую тему на форуме **4pda.to** (или **4pda.ru**).
    > **Важно:** Вы должны быть авторизованы, чтобы скрипт имел доступ к тексту и изображениям.
2.  В правом нижнем углу появится круглая кнопка **⇓**.
3.  Нажмите её, чтобы открыть настройки:
    *   **С стр / По стр:** Диапазон страниц (определяется автоматически).
    *   **Пауза:** Задержка в мс (рекомендуется **1200** мс во избежание бана по IP).
    *   **Для ИИ:** Включить режим оптимизации для датасетов.
4.  Нажмите **СКАЧАТЬ**.
5.  Следите за прогрессом на панели. По завершении файл сохранится автоматически.

---

## Сравнение форматов

### 1. Стандартный режим
Подходит для чтения, архивации и поиска информации человеком.

```text
Время: 12.11.24, 14:21
Автор: densen2002
Номер: #3
Сообщение:
>> #2 SanyaPDA,

SanyaPDA @ 12.11.24, 11:09 [ #2 ]
«Второй вопрос РРР сикрет задан пользователь для ВПН...»

на столе проверяли или только через интернет?
смахивает на DPI [ https://google.com/... ]
```

### 2. Режим «Для ИИ»
Максимальная плотность информации. Удален "мусор", картинки и даты. Идеально для RAG или Fine-tuning.

```text
#3 densen2002: >#2 на столе проверяли или только через интернет? смахивает на DPI [ google.com/... ]
#4 SanyaPDA: >#3 Проверял только через инет. Клиент утверждает что после накатывания бекапа всё восстановилось.
#5 UserOne: Вот скриншот настроек [IMG] и ссылка на прошивку [LINK]
```

---

## Важная информация

1.  **Кодировка:** Скрипт принудительно декодирует ответы сервера из `windows-1251`, чтобы избежать "кракозябр".
2.  **Лимиты сайта:** 4PDA чувствителен к частым запросам.
    *   Не ставьте паузу менее **1000 мс**.
    *   Если вы получили ошибку `!!! ОШИБКА ЗАГРУЗКИ СТРАНИЦЫ !!!`, значит сайт временно ограничил доступ (ошибка 403 или 503). Остановите скрипт, подождите пару минут и увеличьте паузу.
3.  **Cookies:** Скрипт работает от вашего имени, используя текущую сессию браузера. Никакие пароли никуда не передаются.
